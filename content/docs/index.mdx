## dnd-block-tree

A framework-agnostic, type-safe library for building hierarchical drag-and-drop interfaces. The headless core (`@dnd-block-tree/core`) provides tree logic, reducers, and utilities with zero dependencies. The React adapter adds [@dnd-kit](https://dndkit.com/) integration, components, and hooks on top.

### Features

<CardGrid>
  <MiniCard title="Framework-Agnostic Core">
    Zero-dependency headless core with tree factory, reducers, and utilities -- use with any framework or on the server.
  </MiniCard>
  <MiniCard title="Type-Safe Renderers">
    Generic types ensure each block type gets the correct renderer props -- containers receive `children`, `isExpanded`, and `onToggleExpand` automatically.
  </MiniCard>
  <MiniCard title="Headless & Flexible">
    No built-in styles or opinions. You control every pixel of rendering with your own components.
  </MiniCard>
  <MiniCard title="Undo/Redo">
    Built-in `useBlockHistory` hook with configurable stack depth for full undo/redo support.
  </MiniCard>
  <MiniCard title="Keyboard Navigation">
    Arrow keys, Home/End, Enter/Space for full keyboard-driven tree navigation with proper ARIA roles.
  </MiniCard>
  <MiniCard title="Multi-Select">
    Cmd/Ctrl+Click and Shift+Click selection with batch drag-and-drop that preserves relative order.
  </MiniCard>
  <MiniCard title="Touch & Mobile">
    Long-press activation, haptic feedback, and touch-optimized sensors for mobile devices.
  </MiniCard>
  <MiniCard title="SSR Compatible">
    `BlockTreeSSR` component with hydration-safe rendering and configurable fallback content.
  </MiniCard>
  <MiniCard title="Virtual Scrolling">
    Render thousands of items efficiently with fixed-height virtualization and configurable overscan.
  </MiniCard>
  <MiniCard title="Fractional Indexing">
    CRDT-compatible ordering strategy using lexicographic keys -- no sibling reindexing needed.
  </MiniCard>
  <MiniCard title="Depth Constraints">
    `maxDepth` enforcement with `onBeforeMove` middleware for cancelling or transforming moves.
  </MiniCard>
  <MiniCard title="FLIP Animation">
    Smooth expand/collapse transitions and `useLayoutAnimation` for reorder animations.
  </MiniCard>
  <MiniCard title="Serialization">
    Convert between flat arrays and nested trees with `flatToNested` and `nestedToFlat` utilities.
  </MiniCard>
</CardGrid>

### Packages

| Package | Description |
|---------|-------------|
| [`@dnd-block-tree/react`](https://www.npmjs.com/package/@dnd-block-tree/react) | React adapter — components, hooks, @dnd-kit integration |
| [`@dnd-block-tree/core`](https://www.npmjs.com/package/@dnd-block-tree/core) | Framework-agnostic core — types, reducers, tree factory, utilities (zero deps) |

Most users should install `@dnd-block-tree/react`. Use `@dnd-block-tree/core` directly for non-React use cases (server-side manipulation, testing, other frameworks).

### Quick Start

```bash
npm install @dnd-block-tree/react @dnd-kit/core @dnd-kit/utilities
```

```tsx
import { BlockTree, type BaseBlock, type BlockRenderers } from '@dnd-block-tree/react'

interface MyBlock extends BaseBlock {
  type: 'section' | 'task'
  title: string
}

const renderers: BlockRenderers<MyBlock, ['section']> = {
  section: ({ block, children, isExpanded, onToggleExpand }) => (
    <div className="border rounded p-2">
      <button onClick={onToggleExpand}>
        {isExpanded ? '▼' : '▶'} {block.title}
      </button>
      {isExpanded && <div className="ml-4">{children}</div>}
    </div>
  ),
  task: ({ block }) => <div className="p-2">{block.title}</div>,
}

function App() {
  const [blocks, setBlocks] = useState<MyBlock[]>([
    { id: '1', type: 'section', title: 'Tasks', parentId: null, order: 0 },
    { id: '2', type: 'task', title: 'Do something', parentId: '1', order: 0 },
  ])

  return (
    <BlockTree
      blocks={blocks}
      renderers={renderers}
      containerTypes={['section']}
      onChange={setBlocks}
    />
  )
}
```

See [Installation & Setup](/docs/getting-started) for peer dependencies and a complete walkthrough.

### Explore the Docs

- [**Core Overview**](/docs/core) -- headless API, `createBlockTree`, reducers, and what's in core vs React
- [**BlockTree Props**](/docs/api) -- every prop with type, default, and description
- [**Callbacks & Events**](/docs/callbacks) -- hook into the drag-and-drop lifecycle
- [**Type Reference**](/docs/types) -- all exported types and interfaces
- [**Undo/Redo**](/docs/undo-redo) -- `useBlockHistory` hook
- [**Keyboard Navigation**](/docs/keyboard-navigation) -- key bindings and a11y
- [**Multi-Select**](/docs/multi-select) -- selection modes and batch drag
- [**Depth & Middleware**](/docs/constraints) -- `maxDepth` and `onBeforeMove`
- [**Fractional Indexing**](/docs/fractional-indexing) -- CRDT-compatible ordering
- [**Serialization**](/docs/serialization) -- flat/nested conversion utilities
- [**Touch & Mobile**](/docs/touch-mobile) -- long-press, haptics, mobile sensors
- [**SSR Compatibility**](/docs/ssr) -- server-side rendering support
- [**Animation**](/docs/animation) -- expand transitions and FLIP animations
- [**Virtual Scrolling**](/docs/virtual-scrolling) -- fixed-height virtualization
- [**Collision Detection**](/docs/collision-detection) -- custom algorithms
- [**Utilities**](/docs/utilities) -- tree operations and helper functions
